!function(a){"use strict";function x(a){return"undefined"!=typeof a}function y(a){return"object"==typeof a&&null!=a}function z(a,b,c){return isNaN(a)?c:h(c,g(b,a))}function A(){return!1}function B(){return(new Date).valueOf()}function C(a,b){var e,c=[],d=a.length;for(e=0;d>e;++e)c.push(a[e]);return c.sort(b),c}function D(a){for(var c,d,b=a.length-1;b;)d=~~(Math.random()*b),c=a[b],a[b]=a[d],a[d]=c,--b}function E(a,b,c){this.x=a,this.y=b,this.z=c}function F(a,b){b=b*Math.PI/180,a=a*Math.PI/180;var c=e(a)*f(b),d=-e(b),g=-f(a)*f(b);return new E(c,d,g)}function G(a){this[1]={1:a[0],2:a[1],3:a[2]},this[2]={1:a[3],2:a[4],3:a[5]},this[3]={1:a[6],2:a[7],3:a[8]}}function H(a,b,c,d){var g,h,i,k,l=[],m=Math.PI*(3-j(5)),n=2/a;for(g=0;a>g;++g)h=g*n-1+n/2,i=j(1-h*h),k=g*m,l.push([f(k)*i*b,h*c,e(k)*i*d]);return l}function I(a,b,c,d,g){var h,m,n,o,p,i=[],k=Math.PI*(3-j(5)),l=2/a;for(m=0;a>m;++m)n=m*l-1+l/2,h=m*k,o=f(h),p=e(h),i.push(b?[n*c,o*d,p*g]:[o*c,n*d,p*g]);return i}function J(a,b,c,d,g,h){var i,l,m,n,j=[],k=2*Math.PI/b;for(l=0;b>l;++l)i=l*k,m=f(i),n=e(i),j.push(a?[h*c,m*d,n*g]:[m*c,h*d,n*g]);return j}function K(a,b,c,d){return I(a,0,b,c,d)}function L(a,b,c,d){return I(a,1,b,c,d)}function M(a,b,c,d,e){return e=isNaN(e)?0:1*e,J(0,a,b,c,d,e)}function N(a,b,c,d,e){return e=isNaN(e)?0:1*e,J(1,a,b,c,d,e)}function O(a,b){var d,e,c=a,f=(1*b).toPrecision(3)+")";return"#"===a[0]?(l[a]||(l[a]=4===a.length?"rgba("+n[a[1]]+n[a[2]]+n[a[3]]:"rgba("+m[a.substr(1,2)]+m[a.substr(3,2)]+m[a.substr(5,2)]),c=l[a]+f):"rgb("===a.substr(0,4)||"hsl("===a.substr(0,4)?c=a.replace("(","a(").replace(")",","+f):("rgba("===a.substr(0,5)||"hsla("===a.substr(0,5))&&(d=a.lastIndexOf(",")+1,e=a.indexOf(")"),b*=parseFloat(a.substring(d,e)),c=a.substr(0,d)+b.toPrecision(3)+")"),c}function P(a,b){if(window.G_vmlCanvasManager)return null;var c=u.createElement("canvas");return c.width=a,c.height=b,c}function Q(){var b,c,a=P(3,3);return a?(b=a.getContext("2d"),b.strokeStyle="#000",b.shadowColor="#fff",b.shadowBlur=3,b.globalAlpha=0,b.strokeRect(2,2,2,2),b.globalAlpha=1,c=b.getImageData(2,2,1,1),a=null,c.data[0]>0):!1}function R(a,b){var e,f,g,h,i,c=1024,d=a.weightGradient;if(a.gCanvas)f=a.gCanvas.getContext("2d");else{if(a.gCanvas=e=P(c,1),!e)return null;f=e.getContext("2d"),h=f.createLinearGradient(0,0,c,0);for(g in d)h.addColorStop(1-g,d[g]);f.fillStyle=h,f.fillRect(0,0,c,1)}return i=f.getImageData(~~((c-1)*b),0,1,1).data,"rgba("+i[0]+","+i[1]+","+i[2]+","+i[3]/255+")"}function S(a,b,c,e,f,g,h,i,j){var m,n,k=(g||0)+(h&&h[0]<0?d(h[0]):0),l=(g||0)+(h&&h[1]<0?d(h[1]):0);for(a.font=b,a.textBaseline="top",a.fillStyle=c,f&&(a.shadowColor=f),g&&(a.shadowBlur=g),h&&(a.shadowOffsetX=h[0],a.shadowOffsetY=h[1]),m=0;m<e.length;++m)n=j?(i-j[m])/2:0,a.fillText(e[m],k+n,l),l+=parseInt(b)}function T(a,b,c,e,f,g,h,i,j,k,l,m,n){var q,r,o=e+d(j[0])+i+i,p=f+d(j[1])+i+i;return(q=P(o+k,p+l))?(r=q.getContext("2d"),S(r,b,g,a,h,i,j,m,n),q):null}function U(a,b,c,e){var l,m,f=d(e[0]),g=d(e[1]),h=a.width+(f>c?f+c:2*c),i=a.height+(g>c?g+c:2*c),j=(c||0)+(e[0]<0?f:0),k=(c||0)+(e[1]<0?g:0);return(l=P(h,i))?(m=l.getContext("2d"),b&&(m.shadowColor=b),c&&(m.shadowBlur=c),e&&(m.shadowOffsetX=e[0],m.shadowOffsetY=e[1]),m.drawImage(a,j,k,a.width,a.height),l):null}function V(a,b,c){var g,h,i,j,k,l,m,n,d=parseInt(a.toString().length*c),e=parseInt(2*c*a.length),f=P(d,e);if(!f)return null;for(g=f.getContext("2d"),g.fillStyle="#000",g.fillRect(0,0,d,e),S(g,c+"px "+b,"#fff",a,0,0,[]),h=g.getImageData(0,0,d,e),i=h.width,j=h.height,n={min:{x:i,y:j},max:{x:-1,y:-1}},l=0;j>l;++l)for(k=0;i>k;++k)m=4*(l*i+k),h.data[m+1]>0&&(k<n.min.x&&(n.min.x=k),k>n.max.x&&(n.max.x=k),l<n.min.y&&(n.min.y=l),l>n.max.y&&(n.max.y=l));return i!=d&&(n.min.x*=d/i,n.max.x*=d/i),j!=e&&(n.min.y*=d/j,n.max.y*=d/j),f=null,n}function W(a){return"'"+a.replace(/(\'|\")/g,"").replace(/\s*,\s*/g,"', '")+"'"}function X(a,b,c){c=c||u,c.addEventListener?c.addEventListener(a,b,!1):c.attachEvent("on"+a,b)}function Y(a,b,c,d){var f,e=d.imageScale;return b.complete?a.complete?(b.width=b.width,b.height=b.height,e&&(a.width=b.width*e,a.height=b.height*e),c.w=a.width,c.h=a.height,d.txtOpt&&d.shadow&&(f=U(a,d.shadow,d.shadowBlur,d.shadowOffset),f&&(c.image=f,c.w=f.width,c.h=f.height)),void 0):X("load",function(){Y(a,b,c,d)},a):X("load",function(){Y(a,b,c,d)},b)}function Z(a,b){var c=u.defaultView,d=b.replace(/\-([a-z])/g,function(a){return a.charAt(1).toUpperCase()});return c&&c.getComputedStyle&&c.getComputedStyle(a,null).getPropertyValue(b)||a.currentStyle&&a.currentStyle[d]}function $(a,b){var d,c=1;return a.weightFrom?c=1*(b.getAttribute(a.weightFrom)||a.textHeight):(d=Z(b,"font-size"))?c=d.indexOf("px")>-1&&1*d.replace("px","")||d.indexOf("pt")>-1&&1.25*d.replace("pt","")||3.3*d:a.weight=!1,c}function _(a){return a.target&&x(a.target.id)?a.target.id:a.srcElement.parentNode.id}function ab(a,b){var c,d,e=parseInt(Z(b,"width"))/b.width,f=parseInt(Z(b,"height"))/b.height;return x(a.offsetX)?c={x:a.offsetX,y:a.offsetY}:(d=kb(b.id),x(a.changedTouches)&&(a=a.changedTouches[0]),a.pageX&&(c={x:a.pageX-d.x,y:a.pageY-d.y})),c&&e&&f&&(c.x/=e,c.y/=f),c}function bb(a){var b=a.target||a.fromElement.parentNode,c=pb.tc[b.id];c&&(c.mx=c.my=-1,c.UnFreeze(),c.EndDrag())}function cb(a){var b,d,e,c=pb,f=_(a);for(b in c.tc)d=c.tc[b],d.tttimer&&(clearTimeout(d.tttimer),d.tttimer=null);f&&c.tc[f]&&(d=c.tc[f],(e=ab(a,d.canvas))&&(d.mx=e.x,d.my=e.y,d.Drag(a,e)),d.drawn=0)}function db(a){var b=pb,c=u.addEventListener?0:1,d=_(a);d&&a.button==c&&b.tc[d]&&b.tc[d].BeginDrag(a)}function eb(a){var e,b=pb,c=u.addEventListener?0:1,d=_(a);d&&a.button==c&&b.tc[d]&&(e=b.tc[d],cb(a),e.EndDrag()||e.touched||e.Clicked(a))}function fb(a){var b=pb,c=_(a);c&&a.changedTouches&&b.tc[c]&&(b.tc[c].touched=1,b.tc[c].BeginDrag(a))}function gb(a){var b=pb,c=_(a);c&&a.changedTouches&&b.tc[c]&&(hb(a),b.tc[c].EndDrag()||(b.tc[c].Draw(),b.tc[c].Clicked(a)))}function hb(a){var b,d,e,c=pb,f=_(a);for(b in c.tc)d=c.tc[b],d.tttimer&&(clearTimeout(d.tttimer),d.tttimer=null);f&&c.tc[f]&&a.changedTouches&&(d=c.tc[f],(e=ab(a,d.canvas))&&(d.mx=e.x,d.my=e.y,d.Drag(a,e)),d.drawn=0)}function ib(a){var b=pb,c=_(a);c&&b.tc[c]&&(a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault(),b.tc[c].Wheel((a.wheelDelta||a.detail)>0))}function jb(a){var c,d,b=pb.tc;a=a||B();for(c in b)d=b[c].interval,b[c].Draw(a);pb.NextFrame(d)}function kb(a){var b=u.getElementById(a),c=b.getBoundingClientRect(),d=u.documentElement,e=u.body,f=window,g=f.pageXOffset||d.scrollLeft,h=f.pageYOffset||d.scrollTop,i=d.clientLeft||e.clientLeft,j=d.clientTop||e.clientTop;return{x:c.left+g-i,y:c.top+h-j}}function lb(a,b,c,d){var e=a.radius*a.z1/(a.z1+a.z2+b.z);return{x:b.x*e*c,y:b.y*e*d,z:b.z,w:(a.z1-b.z)/a.z2}}function mb(a){this.e=a,this.br=0,this.line=[],this.text=[],this.original=a.innerText||a.textContent}function nb(a){this.ts=B(),this.tc=a,this.x=this.y=this.w=this.h=this.sc=1,this.z=0,this.Draw=a.pulsateTo<1&&"colour"!=a.outlineMethod?this.DrawPulsate:this.DrawSimple,this.SetMethod(a.outlineMethod)}function ob(a,b,c,d,e,f,g,h,i){var j=a.ctxt;this.tc=a,this.image=b.src?b:null,this.text=b.src?[]:b,this.text_original=i,this.line_widths=[],this.title=c.title||null,this.a=c,this.position=new E(d[0],d[1],d[2]),this.x=this.y=this.z=0,this.w=e,this.h=f,this.colour=g||a.textColour,this.textFont=h||a.textFont,this.weight=this.sc=this.alpha=1,this.weighted=!a.weight,this.outline=new nb(a),this.image||(this.textHeight=a.textHeight,this.extents=V(this.text,this.textFont,this.textHeight),this.Measure(j,a)),this.SetShadowColour=a.shadowAlpha?this.SetShadowColourAlpha:this.SetShadowColourFixed,this.SetDraw(a)}function pb(a,b,c){var d,e,f=u.getElementById(a),g=["id","class","innerHTML"];if(!f)throw 0;if(x(window.G_vmlCanvasManager)&&(f=window.G_vmlCanvasManager.initElement(f),this.ie=parseFloat(navigator.appVersion.split("MSIE")[1])),f&&(!f.getContext||!f.getContext("2d").fillText)){for(e=u.createElement("DIV"),d=0;d<g.length;++d)e[g[d]]=f[g[d]];throw f.parentNode.insertBefore(e,f),f.parentNode.removeChild(f),0}for(d in pb.options)this[d]=c&&x(c[d])?c[d]:x(pb[d])?pb[d]:pb.options[d];this.canvas=f,this.ctxt=f.getContext("2d"),this.z1=250/this.depth,this.z2=this.z1/this.zoom,this.radius=.0075*h(f.height,f.width),this.max_weight=0,this.min_weight=200,this.textFont=this.textFont&&W(this.textFont),this.textHeight*=1,this.pulsateTo=z(this.pulsateTo,0,1),this.minBrightness=z(this.minBrightness,0,1),this.maxBrightness=z(this.maxBrightness,this.minBrightness,1),this.ctxt.textBaseline="top",this.lx=(this.lock+"").indexOf("x")+1,this.ly=(this.lock+"").indexOf("y")+1,this.frozen=this.dx=this.dy=this.fixedAnim=this.touched=0,this.fixedAlpha=1,this.source=b||a,this.transform=G.Identity(),this.startTime=this.time=B(),this.Animate=this.dragControl?this.AnimateDrag:this.AnimatePosition,this.animTiming="function"==typeof pb[this.animTiming]?pb[this.animTiming]:pb.Smooth,this.shadowBlur||this.shadowOffset[0]||this.shadowOffset[1]?(this.ctxt.shadowColor=this.shadow,this.shadow=this.ctxt.shadowColor,this.shadowAlpha=Q()):delete this.shadow,this.Load(),b&&this.hideTags&&function(a){pb.loaded?a.HideTags():X("load",function(){a.HideTags()},window)}(this),this.yaw=this.initial?this.initial[0]*this.maxSpeed:0,this.pitch=this.initial?this.initial[1]*this.maxSpeed:0,this.tooltip?"native"==this.tooltip?this.Tooltip=this.TooltipNative:(this.Tooltip=this.TooltipDiv,this.ttdiv||(this.ttdiv=u.createElement("div"),this.ttdiv.className=this.tooltipClass,this.ttdiv.style.position="absolute",this.ttdiv.style.zIndex=f.style.zIndex+1,X("mouseover",function(a){a.target.style.display="none"},this.ttdiv),u.body.appendChild(this.ttdiv))):this.Tooltip=this.TooltipNone,this.noMouse||w[a]||(X("mousemove",cb,f),X("mouseout",bb,f),X("mouseup",eb,f),X("touchstart",fb,f),X("touchend",gb,f),X("touchcancel",gb,f),X("touchmove",hb,f),this.dragControl&&(X("mousedown",db,f),X("selectstart",A,f)),this.wheelZoom&&(X("mousewheel",ib,f),X("DOMMouseScroll",ib,f)),w[a]=1),pb.started||(pb.started=setTimeout(jb,this.interval))}function qb(a,b){pb.tc[b]&&pb.tc[b][a]()}var b,c,o,p,q,r,s,t,v,d=Math.abs,e=Math.sin,f=Math.cos,g=Math.max,h=Math.min,i=Math.ceil,j=Math.sqrt,k=Math.pow,l={},m={},n={0:"0,",1:"17,",2:"34,",3:"51,",4:"68,",5:"85,",6:"102,",7:"119,",8:"136,",9:"153,",a:"170,",A:"170,",b:"187,",B:"187,",c:"204,",C:"204,",d:"221,",D:"221,",e:"238,",E:"238,",f:"255,",F:"255,"},u=document,w={};for(b=0;256>b;++b)c=b.toString(16),16>b&&(c="0"+c),m[c]=m[c.toUpperCase()]=b.toString()+",";s=E.prototype,s.length=function(){return j(this.x*this.x+this.y*this.y+this.z*this.z)},s.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z},s.cross=function(a){var b=this.y*a.z-this.z*a.y,c=this.z*a.x-this.x*a.z,d=this.x*a.y-this.y*a.x;return new E(b,c,d)},s.angle=function(a){var c,b=this.dot(a);return 0==b?Math.PI/2:(c=b/(this.length()*a.length()),c>=1?0:-1>=c?Math.PI:Math.acos(c))},s.unit=function(){var a=this.length();return new E(this.x/a,this.y/a,this.z/a)},r=G.prototype,G.Identity=function(){return new G([1,0,0,0,1,0,0,0,1])},G.Rotation=function(a,b){var c=e(a),d=f(a),g=1-d;return new G([d+k(b.x,2)*g,b.x*b.y*g-b.z*c,b.x*b.z*g+b.y*c,b.y*b.x*g+b.z*c,d+k(b.y,2)*g,b.y*b.z*g-b.x*c,b.z*b.x*g-b.y*c,b.z*b.y*g+b.x*c,d+k(b.z,2)*g])},r.mul=function(a){var c,d,b=[],e=a.xform?1:0;for(c=1;3>=c;++c)for(d=1;3>=d;++d)e?b.push(this[c][1]*a[1][d]+this[c][2]*a[2][d]+this[c][3]*a[3][d]):b.push(this[c][d]*a);return new G(b)},r.xform=function(a){var b={},c=a.x,d=a.y,e=a.z;return b.x=c*this[1][1]+d*this[2][1]+e*this[3][1],b.y=c*this[1][2]+d*this[2][2]+e*this[3][2],b.z=c*this[1][3]+d*this[2][3]+e*this[3][3],b},t=mb.prototype,t.Lines=function(a){var c,d,e,b=a?1:0;for(a=a||this.e,c=a.childNodes,d=c.length,e=0;d>e;++e)"BR"==c[e].nodeName?(this.text.push(this.line.join(" ")),this.br=1):3==c[e].nodeType?this.br?(this.line=[c[e].nodeValue],this.br=0):this.line.push(c[e].nodeValue):this.Lines(c[e]);return b||this.br||this.text.push(this.line.join(" ")),this.text},t.SplitWidth=function(a,b,c,d){var e,f,g,h=[];for(b.font=d+"px "+c,e=0;e<this.text.length;++e){for(g=this.text[e].split(/\s+/),this.line=[g[0]],f=1;f<g.length;++f)b.measureText(this.line.join(" ")+" "+g[f]).width>a?(h.push(this.line.join(" ")),this.line=[g[f]]):this.line.push(g[f]);h.push(this.line.join(" "))}return this.text=h},o=nb.prototype,o.SetMethod=function(a){var b={block:["PreDraw","DrawBlock"],colour:["PreDraw","DrawColour"],outline:["PostDraw","DrawOutline"],classic:["LastDraw","DrawOutline"],none:["LastDraw"]},c=b[a]||b.outline;"none"==a?this.Draw=function(){return 1}:this.drawFunc=this[c[1]],this[c[0]]=this.Draw},o.Update=function(a,b,c,d,e,f,g,h){var i=this.tc.outlineOffset,j=2*i;this.x=e*a+g-i,this.y=e*b+h-i,this.w=e*c+j,this.h=e*d+j,this.sc=e,this.z=f},o.DrawOutline=function(a,b,c,d,e,f){a.strokeStyle=f,a.strokeRect(b,c,d,e)},o.DrawColour=function(a,b,c,d,e,f,g,h,i){return this[g.image?"DrawColourImage":"DrawColourText"](a,b,c,d,e,f,g,h,i)},o.DrawColourText=function(a,b,c,d,e,f,g,h,i){var j=g.colour;return g.colour=f,g.alpha=1,g.Draw(a,h,i),g.colour=j,1},o.DrawColourImage=function(a,b,c,d,e,f,i,j,k){var q,l=a.canvas,m=~~g(b,0),n=~~g(c,0),o=0|h(l.width-m,d)+.5,p=0|h(l.height-n,e)+.5;return v?(v.width=o,v.height=p):v=P(o,p),v?(q=v.getContext("2d"),q.drawImage(l,m,n,o,p,0,0,o,p),a.clearRect(m,n,o,p),i.alpha=1,i.Draw(a,j,k),a.setTransform(1,0,0,1,0,0),a.save(),a.beginPath(),a.rect(m,n,o,p),a.clip(),a.globalCompositeOperation="source-in",a.fillStyle=f,a.fillRect(m,n,o,p),a.restore(),a.globalCompositeOperation="destination-over",a.drawImage(v,0,0,o,p,m,n,o,p),a.globalCompositeOperation="source-over",1):this.SetMethod("outline")},o.DrawBlock=function(a,b,c,d,e,f){a.fillStyle=f,a.fillRect(b,c,d,e)},o.DrawSimple=function(a,b,c,d){var e=this.tc;return a.setTransform(1,0,0,1,0,0),a.strokeStyle=e.outlineColour,a.lineWidth=e.outlineThickness,a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0,a.globalAlpha=1,this.drawFunc(a,this.x,this.y,this.w,this.h,e.outlineColour,b,c,d)},o.DrawPulsate=function(a,b,c,d){var e=B()-this.ts,g=this.tc;return a.setTransform(1,0,0,1,0,0),a.strokeStyle=g.outlineColour,a.lineWidth=g.outlineThickness,a.shadowBlur=a.shadowOffsetX=a.shadowOffsetY=0,a.globalAlpha=g.pulsateTo+(1-g.pulsateTo)*(.5+f(2*Math.PI*e/(1e3*g.pulsateTime))/2),this.drawFunc(a,this.x,this.y,this.w,this.h,g.outlineColour,b,c,d)},o.Active=function(a,b,c){return b>=this.x&&c>=this.y&&b<=this.x+this.w&&c<=this.y+this.h},o.PreDraw=o.PostDraw=o.LastDraw=A,p=ob.prototype,p.EqualTo=function(a){var b=a.getElementsByTagName("img");return this.a.href!=a.href?0:b.length?this.image.src==b[0].src:(a.innerText||a.textContent)==this.text_original},p.SetDraw=function(a){this.Draw=this.image?a.ie>7?this.DrawImageIE:this.DrawImage:this.DrawText,a.noSelect&&(this.CheckActive=A)},p.MeasureText=function(a){var b,e,c=this.text.length,d=0;for(b=0;c>b;++b)this.line_widths[b]=e=a.measureText(this.text[b]).width,d=g(d,e);return d},p.Measure=function(a,b){if(this.h=this.extents?this.extents.max.y+this.extents.min.y:this.textHeight,a.font=this.font=this.textHeight+"px "+this.textFont,this.w=this.MeasureText(a),b.txtOpt){var g,c=b.txtScale,d=c*this.textHeight,e=d+"px "+this.textFont,f=[c*b.shadowOffset[0],c*b.shadowOffset[1]];a.font=e,g=this.MeasureText(a),this.image=T(this.text,e,d,g,c*this.h,this.colour,b.shadow,c*b.shadowBlur,f,c,c,g,this.line_widths),this.image&&(this.w=this.image.width/c,this.h=this.image.height/c),this.SetDraw(b),b.txtOpt=!!this.image}},p.SetFont=function(a,b){this.textFont=a,this.colour=b,this.extents=V(this.text,this.textFont,this.textHeight),this.Measure(this.tc.ctxt,this.tc)},p.SetWeight=function(a){this.text.length&&(this.weight=a,this.Weight(this.tc.ctxt,this.tc),this.Measure(this.tc.ctxt,this.tc))},p.Weight=function(a,b){var c=this.weight,d=b.weightMode;this.weighted=!0,("colour"==d||"both"==d)&&(this.colour=R(b,(c-b.min_weight)/(b.max_weight-b.min_weight))),("size"==d||"both"==d)&&(this.textHeight=b.weightSizeMin>0&&b.weightSizeMax>b.weightSizeMin?b.weightSize*(b.weightSizeMin+(b.weightSizeMax-b.weightSizeMin)*(c-b.min_weight)/(b.max_weight-b.min_weight)):c*b.weightSize),this.extents=V(this.text,this.textFont,this.textHeight)},p.SetShadowColourFixed=function(a,b){a.shadowColor=b},p.SetShadowColourAlpha=function(a,b,c){a.shadowColor=O(b,c)},p.DrawText=function(a,b,c){var h,i,d=this.tc,e=this.x,f=this.y,g=this.sc;for(a.globalAlpha=this.alpha,a.fillStyle=this.colour,d.shadow&&this.SetShadowColour(a,d.shadow,this.alpha),a.font=this.font,e+=b/g,f+=c/g-this.h/2,h=0;h<this.text.length;++h)i=e-this.line_widths[h]/2,a.setTransform(g,0,0,g,g*i,g*f),a.fillText(this.text[h],0,0),f+=this.textHeight},p.DrawImage=function(a,b,c){var d=this.x,e=this.y,f=this.sc,g=this.image,h=this.w,i=this.h,j=this.alpha,k=this.shadow;a.globalAlpha=j,k&&this.SetShadowColour(a,k,j),d+=b/f-h/2,e+=c/f-i/2,a.setTransform(f,0,0,f,f*d,f*e),a.drawImage(g,0,0,h,i)},p.DrawImageIE=function(a,b,c){var d=this.image,e=this.sc,f=d.width=this.w*e,g=d.height=this.h*e,h=this.x*e+b-f/2,i=this.y*e+c-g/2;a.setTransform(1,0,0,1,0,0),a.globalAlpha=this.alpha,a.drawImage(d,h,i)},p.Calc=function(a,b){var c,d=this.tc,e=d.minBrightness,f=d.maxBrightness,g=d.max_radius;c=a.xform(this.position),this.xformed=c,c=lb(d,c,d.stretchX,d.stretchY),this.x=c.x,this.y=c.y,this.z=c.z,this.sc=c.w,this.alpha=b*z(e+(f-e)*(g-this.z)/(2*g),0,1)},p.CheckActive=function(a,b,c){var d=this.tc,e=this.outline,f=this.w,g=this.h,h=this.x-f/2,i=this.y-g/2;return e.Update(h,i,f,g,this.sc,this.z,b,c),e.Active(a,d.mx,d.my)?e:null},p.Clicked=function(){var e,b=this.a,c=b.target,d=b.href;if(""==c||"_self"==c){if(u.createEvent){if(e=u.createEvent("MouseEvents"),e.initMouseEvent("click",1,1,window,0,0,0,0,0,0,0,0,0,0,null),!b.dispatchEvent(e))return}else if(b.fireEvent&&!b.fireEvent("onclick"))return;u.location=d}else if(self.frames[c])self.frames[c].document.location=d;else{try{if(top.frames[c])return top.frames[c].document.location=d,void 0}catch(f){}window.open(d,c)}},q=pb.prototype,q.SourceElements=function(){return u.querySelectorAll?u.querySelectorAll("#"+this.source):[u.getElementById(this.source)]},q.HideTags=function(){var b,a=this.SourceElements();for(b=0;b<a.length;++b)a[b].style.display="none"},q.GetTags=function(){var b,d,e,a=this.SourceElements(),c=[];for(d=0;d<a.length;++d)for(b=a[d].getElementsByTagName("a"),e=0;e<b.length;++e)c.push(b[e]);return c},q.CreateTag=function(a,b){var d,e,f,g,c=a.getElementsByTagName("img");return b=b||[0,0,0],c.length?(d=new Image,d.src=c[0].src,e=new ob(this,d,a,b,0,0),Y(d,c[0],e,this),e):(f=new mb(a),e=f.Lines(),g=this.textFont||W(Z(a,"font-family")),this.splitWidth&&(e=f.SplitWidth(this.splitWidth,this.ctxt,g,this.textHeight)),new ob(this,e,a,b,2,this.textHeight+2,this.textColour||Z(a,"color"),g,f.original))},q.UpdateTag=function(a,b){var c=this.textColour||Z(b,"color"),d=this.textFont||W(Z(b,"font-family"));a.title=b.title,(a.colour!=c||a.textFont!=d)&&a.SetFont(d,c)},q.Weight=function(a){var c,d,b=a.length,e=[];for(d=0;b>d;++d)c=$(this,a[d].a),c>this.max_weight&&(this.max_weight=c),c<this.min_weight&&(this.min_weight=c),e.push(c);if(this.max_weight>this.min_weight)for(d=0;b>d;++d)a[d].SetWeight(e[d])},q.Load=function(){var c,d,e,f,h,i,j,a=this.GetTags(),b=[],k=[],l={sphere:H,vcylinder:K,hcylinder:L,vring:M,hring:N};if(a.length){for(k.length=a.length,j=0;j<a.length;++j)k[j]=j;for(this.shuffleTags&&D(k),e=100*this.radiusX,f=100*this.radiusY,h=100*this.radiusZ,this.max_radius=g(e,g(f,h)),this.shapeArgs?this.shapeArgs[0]=a.length:(d=this.shape.toString().split(/[(),]/),c=d.shift(),this.shape=l[c]||l.sphere,this.shapeArgs=[a.length,e,f,h].concat(d)),i=this.shape.apply(this,this.shapeArgs),this.listLength=a.length,j=0;j<a.length;++j)b.push(this.CreateTag(a[k[j]],i[j]));this.weight&&this.Weight(b,!0)}this.taglist=b},q.Update=function(){var d,g,h,j,k,l,a=this.GetTags(),b=[],c=this.taglist,e=[],f=[];if(!this.shapeArgs)return this.Load();if(a.length){for(j=this.listLength=a.length,h=c.length,k=0;h>k;++k)b.push(c[k]),f.push(k);for(k=0;j>k;++k){for(l=0,d=0;h>l;++l)c[l].EqualTo(a[k])&&(this.UpdateTag(b[l],a[k]),d=f[l]=-1);d||e.push(k)}for(k=0,l=0;h>k;++k)-1==f[l]?f.splice(l,1):++l;if(f.length){for(D(f);f.length&&e.length;)k=f.shift(),l=e.shift(),b[k]=this.CreateTag(a[l]);for(f.sort(function(a,b){return a-b});f.length;)b.splice(f.pop(),1)}for(l=b.length/(e.length+1),k=0;e.length;)b.splice(i(++k*l),0,this.CreateTag(a[e.shift()]));for(this.shapeArgs[0]=j=b.length,g=this.shape.apply(this,this.shapeArgs),k=0;j>k;++k)b[k].position=new E(g[k][0],g[k][1],g[k][2]);this.weight&&this.Weight(b)}this.taglist=b},q.SetShadow=function(a){a.shadowBlur=this.shadowBlur,a.shadowOffsetX=this.shadowOffset[0],a.shadowOffsetY=this.shadowOffset[1]},q.Draw=function(a){if(!this.paused){var j,k,l,r,b=this.canvas,c=b.width,d=b.height,e=0,f=(a-this.time)*this.interval/1e3,g=c/2+this.offsetX,h=d/2+this.offsetY,i=this.ctxt,m=-1,n=this.taglist,o=n.length,p=this.frontSelect,q=this.centreFunc==A;if(this.time=a,this.frozen&&this.drawn)return this.Animate(c,d,f);for(r=this.AnimateFixed(),i.setTransform(1,0,0,1,0,0),this.active=null,l=0;o>l;++l)n[l].Calc(this.transform,this.fixedAlpha);for(n=C(n,function(a,b){return b.z-a.z}),l=0;o>l;++l)k=this.mx>=0&&this.my>=0&&this.taglist[l].CheckActive(i,g,h),k&&k.sc>e&&(!p||k.z<=0)&&(j=k,m=l,j.tag=this.taglist[l],e=k.sc);for(this.active=j,this.txtOpt||this.shadow&&this.SetShadow(i),i.clearRect(0,0,c,d),l=0;o>l;++l){if(!q&&n[l].z<=0){try{this.centreFunc(i,c,d,g,h)}catch(s){alert(s),this.centreFunc=A}q=!0}j&&j.tag==n[l]&&j.PreDraw(i,n[l],g,h)||n[l].Draw(i,g,h),j&&j.tag==n[l]&&j.PostDraw(i)}this.freezeActive&&j?this.Freeze():(this.UnFreeze(),this.drawn=o==this.listLength),this.fixedCallback&&(this.fixedCallback(this,this.fixedCallbackTag),this.fixedCallback=null),r||this.Animate(c,d,f),j&&j.LastDraw(i),b.style.cursor=j?this.activeCursor:"",this.Tooltip(j,this.taglist[m])}},q.TooltipNone=function(){},q.TooltipNative=function(a,b){this.canvas.title=a&&b.title?b.title:""},q.TooltipDiv=function(a,b){var c=this,d=c.ttdiv.style,e=c.canvas.id,f="none";a&&b.title?(b.title!=c.ttdiv.innerHTML&&(d.display=f),c.ttdiv.innerHTML=b.title,b.title=c.ttdiv.innerHTML,d.display!=f||c.tttimer||(c.tttimer=setTimeout(function(){var a=kb(e);d.display="block",d.left=a.x+c.mx+"px",d.top=a.y+c.my+24+"px",c.tttimer=null},c.tooltipDelay))):d.display=f},q.Transform=function(a,b,c){if(b||c){var d=e(b),g=f(b),h=e(c),i=f(c),j=new G([i,0,h,0,1,0,-h,0,i]),k=new G([1,0,0,0,g,-d,0,d,g]);a.transform=a.transform.mul(j.mul(k))}},q.AnimateFixed=function(){var a,b,c,d,e;return this.fadeIn&&(b=B()-this.startTime,b>=this.fadeIn?(this.fadeIn=0,this.fixedAlpha=1):this.fixedAlpha=b/this.fadeIn),this.fixedAnim?(this.fixedAnim.transform||(this.fixedAnim.transform=this.transform),a=this.fixedAnim,b=B()-a.t0,c=a.angle,e=this.animTiming(a.t,b),this.transform=a.transform,b>=a.t?(this.fixedCallbackTag=a.tag,this.fixedCallback=a.cb,this.fixedAnim=this.yaw=this.pitch=0):c*=e,d=G.Rotation(c,a.axis),this.transform=this.transform.mul(d),0!=this.fixedAnim):!1},q.AnimatePosition=function(a,b,c){var g,h,d=this,e=d.mx,f=d.my;!d.frozen&&e>=0&&f>=0&&a>e&&b>f?(g=d.maxSpeed,h=d.reverse?-1:1,d.lx||(d.yaw=h*c*(2*g*e/a-g)),d.ly||(d.pitch=h*c*-(2*g*f/b-g)),d.initial=null):d.initial||(d.frozen&&!d.freezeDecel?d.yaw=d.pitch=0:d.Decel(d)),this.Transform(d,d.pitch,d.yaw)},q.AnimateDrag=function(a,b,c){var d=this,e=100*c*d.maxSpeed/d.max_radius/d.zoom;d.dx||d.dy?(d.lx||(d.yaw=d.dx*e/d.stretchX),d.ly||(d.pitch=d.dy*-e/d.stretchY),d.dx=d.dy=0,d.initial=null):d.initial||d.Decel(d),this.Transform(d,d.pitch,d.yaw)},q.Freeze=function(){this.frozen||(this.preFreeze=[this.yaw,this.pitch],this.frozen=1,this.drawn=0)},q.UnFreeze=function(){this.frozen&&(this.yaw=this.preFreeze[0],this.pitch=this.preFreeze[1],this.frozen=0)},q.Decel=function(a){var b=a.minSpeed,c=d(a.yaw),e=d(a.pitch);!a.lx&&c>b&&(a.yaw=c>a.z0?a.yaw*a.decel:0),!a.ly&&e>b&&(a.pitch=e>a.z0?a.pitch*a.decel:0)},q.Zoom=function(a){this.z2=this.z1*(1/a),this.drawn=0},q.Clicked=function(a){var b=this.active;try{b&&b.tag&&(this.clickToFront===!1||null===this.clickToFront?b.tag.Clicked(a):this.TagToFront(b.tag,this.clickToFront,function(){b.tag.Clicked(a)}))}catch(c){}},q.Wheel=function(a){var b=this.zoom+this.zoomStep*(a?1:-1);this.zoom=h(this.zoomMax,g(this.zoomMin,b)),this.Zoom(this.zoom)},q.BeginDrag=function(a){this.down=ab(a,this.canvas),a.cancelBubble=!0,a.returnValue=!1,a.preventDefault&&a.preventDefault()},q.Drag=function(a,b){if(this.dragControl&&this.down){var c=this.dragThreshold*this.dragThreshold,d=b.x-this.down.x,e=b.y-this.down.y;(this.dragging||d*d+e*e>c)&&(this.dx=d,this.dy=e,this.dragging=1,this.down=b)}},q.EndDrag=function(){var a=this.dragging;return this.dragging=this.down=null,a},q.Pause=function(){this.paused=!0},q.Resume=function(){this.paused=!1},q.FindTag=function(a){if(!x(a))return null;if(x(a.index)&&(a=a.index),!y(a))return this.taglist[a];var b,c,d;for(x(a.id)?(b="id",c=a.id):x(a.text)&&(b="innerText",c=a.text),d=0;d<this.taglist.length;++d)if(this.taglist[d].a[b]==c)return this.taglist[d]},q.RotateTag=function(a,b,c,d,e){var f=a.xformed,g=new E(f.x,f.y,f.z),h=F(c,b),i=g.angle(h),j=g.cross(h).unit();0==i?(this.fixedCallbackTag=a,this.fixedCallback=e):this.fixedAnim={angle:-i,axis:j,t:d,t0:B(),cb:e,tag:a}},q.TagToFront=function(a,b,c){this.RotateTag(a,0,0,b,c)},pb.Start=function(a,b,c){pb.tc[a]=new pb(a,b,c)},pb.Linear=function(a,b){return b/a},pb.Smooth=function(a,b){return.5-f(b*Math.PI/a)/2},pb.Pause=function(a){qb("Pause",a)},pb.Resume=function(a){qb("Resume",a)},pb.Reload=function(a){qb("Load",a)},pb.Update=function(a){qb("Update",a)},pb.TagToFront=function(a,b){return y(b)?(b.lat=b.lng=0,pb.RotateTag(a,b)):!1},pb.RotateTag=function(a,b){if(!y(b))return!1;if(pb.tc[a]){isNaN(b.time)&&(b.time=500);var c=pb.tc[a].FindTag(b);if(c)return pb.tc[a].RotateTag(c,b.lat,b.lng,b.time,b.callback),!0}return!1},pb.NextFrame=function(a){var b=window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;pb.NextFrame=b?pb.NextFrameRAF:pb.NextFrameTimeout,pb.NextFrame(a)},pb.NextFrameRAF=function(){requestAnimationFrame(jb)},pb.NextFrameTimeout=function(a){setTimeout(jb,a)},pb.tc={},pb.options={z1:2e4,z2:2e4,z0:2e-4,freezeActive:!1,freezeDecel:!1,activeCursor:"pointer",pulsateTo:1,pulsateTime:3,reverse:!1,depth:.5,maxSpeed:.05,minSpeed:0,decel:.95,interval:20,minBrightness:.1,maxBrightness:1,outlineColour:"#ffff99",outlineThickness:2,outlineOffset:5,outlineMethod:"outline",textColour:"#ff99ff",textHeight:15,textFont:"Helvetica, Arial, sans-serif",shadow:"#000",shadowBlur:0,shadowOffset:[0,0],initial:null,hideTags:!0,zoom:1,weight:!1,weightMode:"size",weightFrom:null,weightSize:1,weightSizeMin:null,weightSizeMax:null,weightGradient:{0:"#f00",.33:"#ff0",.66:"#0f0",1:"#00f"},txtOpt:!0,txtScale:2,frontSelect:!1,wheelZoom:!0,zoomMin:.3,zoomMax:3,zoomStep:.05,shape:"sphere",lock:null,tooltip:null,tooltipDelay:300,tooltipClass:"tctooltip",radiusX:1,radiusY:1,radiusZ:1,stretchX:1,stretchY:1,offsetX:0,offsetY:0,shuffleTags:!1,noSelect:!1,noMouse:!1,imageScale:1,paused:!1,dragControl:!1,dragThreshold:4,centreFunc:A,splitWidth:0,animTiming:"Smooth",clickToFront:!1,fadeIn:0};for(b in pb.options)pb[b]=pb.options[b];window.TagCanvas=pb,jQuery.fn.tagcanvas=function(b,c){var d={pause:function(){a(this).each(function(){qb("Pause",a(this)[0].id)})},resume:function(){a(this).each(function(){qb("Resume",a(this)[0].id)})},reload:function(){a(this).each(function(){qb("Load",a(this)[0].id)})},update:function(){a(this).each(function(){qb("Update",a(this)[0].id)})},tagtofront:function(){a(this).each(function(){pb.TagToFront(a(this)[0].id,c)})},rotatetag:function(){a(this).each(function(){pb.RotateTag(a(this)[0].id,c)})}};return"string"==typeof b&&d[b]?(d[b].apply(this),void 0):(pb.jquery=1,a(this).each(function(){pb.Start(a(this)[0].id,c,b)}),pb.started)},X("load",function(){pb.loaded=1},window)}(jQuery);