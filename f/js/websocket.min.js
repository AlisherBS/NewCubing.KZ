!function(e){function t(e){this._msgs=store.get(i)||[],this._eventHandlers=store.get(n)||{},this._identifiers=[],this.threshold=2e4,this.lastActiveTime=Date.now(),this.uri=e,this.connect(),this.timer=setInterval(function(){if(this.conn.readyState==WebSocket.CLOSING||this.conn.readyState==WebSocket.CLOSED)return this.fire("disconnect"),void this.connect();Date.now()-this.lastActiveTime>this.threshold&&this.send("ping")}.bind(this),1e3),setInterval(function(){if(this.conn.readyState==WebSocket.OPEN)for(var e in this._identifiers)this.send(this._identifiers[e])}.bind(this),1e4)}if("WebSocket"in e){var i="websocket_msgs",n="websockets_identifiers";t.prototype={safeSend:function(e,t,i){i=t+"-"+i,this._identifiers[i]=e,store.set(n,this._identifiers),this.send(e)},send:function(e){return this.conn.readyState!=WebSocket.OPEN?(this._msgs.push(e),store.set(i,this._msgs),this.connect()):(this.conn.send(JSON.stringify(e)),this.lastActiveTime=Date.now()),this},receive:function(e){this.lastActiveTime=Date.now();var t=e.data;try{if("pong"===(t=JSON.parse(t)))return;if(200===t.code){var i=t.type+"-"+t.data.i;this._identifiers[i]&&delete this._identifiers[i],this.fire(t.type,t.data,t)}}catch(e){}},connect:function(){var e=this;if(!(e.conn instanceof WebSocket&&e.conn.readyState==WebSocket.CONNECTING))try{var t=e.conn=new WebSocket(e.uri);t.onopen=function(){e.fire("connect"),e._msgs.forEach(function(e){t.send(JSON.stringify(e))}),e._msgs=[],store.set(i,[]),e.lastActiveTime=Date.now(),t.onmessage=e.receive.bind(e)}}catch(e){}},on:function(e,t){return this._eventHandlers[e]=this._eventHandlers[e]||[],this._eventHandlers[e].push(t),this},off:function(e,t){if(this._eventHandlers[e]){if(void 0!==t){var i=this._eventHandlers[e].indexOf(t);return i>-1&&this._eventHandlers[e].splice(i,1),this}this._eventHandlers[e]=[]}},fire:function(e,t,i){var n=this;return n._eventHandlers["*"]&&n._eventHandlers["*"].forEach(function(e){e(t,i)}),n._eventHandlers[e]&&n._eventHandlers[e].forEach(function(e){e(t,i)}),n}},e.WS=t}}(this);